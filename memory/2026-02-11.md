# 2026-02-11 — First Day on Nellie-RS

## Summary

Got introduced to the Nellie-RS project by Mike Morris in the Telegram group. Spent time learning the codebase via GitHub issues, commits, and project docs.

## What is Nellie-RS?

A **Rust rewrite** of Nellie — a production-grade semantic code memory system for enterprise engineering teams. Replaces a flaky Python prototype.

**Core Features:**
- **Semantic code search** — natural language queries across indexed repos
- **Lessons learned** — store/retrieve engineering gotchas, patterns, fixes
- **Agent checkpoints** — save/restore AI agent working state
- **Repository indexing** — watch dirs, incremental indexing, .gitignore aware

**Architecture:**
- Rust + Axum HTTP server
- SQLite + sqlite-vec (embedded vector storage)
- ONNX Runtime for embeddings (no Python dependency)
- MCP Protocol (for Claude Code integration)
- Single binary deployment

## Current Status

**Active Bug — #20**: `trigger_reindex` returns 0 files on network mounts

- **Root cause**: macOS fsevents don't propagate for SMB-mounted volumes
- **Impact**: mini-dev-server watching `/Volumes/*-github/` never sees file changes
- **Proposed solutions**:
  1. Polling-based indexing fallback for unreliable fsevents
  2. `--initial-scan` startup option to populate DB
  3. New MCP tools: `full_reindex`, `diff_index`, `index_repo`

**Recently Fixed:**
- #19: Semantic search returning identical results (all distances 0.0) — **FIXED** commit 08398d8 replaced mock zero embeddings with real ONNX inference
- #17: Directory walking for `trigger_reindex` — **FIXED** in PR #18

**Open Feature Requests:**
- #16: AMP Scoping Extension (network/user/project memory layers)
- #15: User field in checkpoint schema for multi-user
- #14: Hybrid search (BM25 + vector embeddings)

**PRs Waiting:**
- Dependabot updates (#1-8) — various dep bumps

## Key Files

- `PROJECT_BRIEF.md` — full architecture, goals, timeline
- `docs/OPERATOR_GUIDE.md` — deployment/operations guide
- `plans/PHASE_*.md` — development phase plans
- `VERIFICATION_REPORT.md`, `FINAL_VERIFICATION_REPORT.md` — test results

## Nellie Service

Not currently running locally. When running:
- Default port: 8080
- Health check: `curl http://localhost:8080/health`
- MCP endpoint: `/mcp` (for Claude Code)

## GitHub

Repo: `mmorris35/nellie-rs`

---

## Work Completed

### Issue #20 - Implemented New Indexing Tools (commit b9b368d)

Added three new MCP tools to work around macOS fsevents not working on network mounts:

1. **`index_repo`** - Index a repo/directory on demand
   - Preferred method for agents to get fresh context
   - Respects `.gitignore`
   - Returns stats: files indexed, unchanged, skipped, chunks created

2. **`diff_index`** - Incremental indexing
   - Compares file mtimes with DB
   - Only indexes new/changed files
   - Removes entries for deleted files
   - Fast for routine syncs

3. **`full_reindex`** - Nuclear option
   - Clears all data under path
   - Re-indexes from scratch

### Storage Helpers Added

- `delete_chunks_by_path_prefix`
- `list_files_by_path_prefix`
- `count_chunks_by_path_prefix`
- `list_file_paths_by_prefix`
- `delete_file_state_by_prefix`

### Note: Pre-existing Test Issues

The test suite has issues — some tests call async handlers from sync tests without `.await`. This predates my changes and should be addressed separately.
